@tailwind base;
@tailwind components;
@tailwind utilities;

/* Document Scanner Animation */
@keyframes scan {
  0% { top: 0; opacity: 0; }
  10% { opacity: 1; }
  90% { opacity: 1; }
  100% { top: 100%; opacity: 0; }
}

.animate-scan {
  animation: scan 2s cubic-bezier(0.4, 0, 0.2, 1) infinite;
}

/* Scanner Overlay */
.scanner-frame {
  box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.75);
}


/* Document Preview Animation */
.document-preview {
  transform-origin: center;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.document-preview.expanded {
  -webkit-transform: scale(0.95);
  transform: scale(0.95);
  z-index: 50;
}

@layer base {
  :root {
    /* Light theme - Enhanced with vibrant artistic touches */
    --background: 180 4% 99%; /* #fcfefd */
    --foreground: 243 84% 14%; /* #060541 */
    --card: 180 4% 99%;
    --card-foreground: 243 84% 14%;
    --popover: 180 4% 99%;
    --popover-foreground: 243 84% 14%;
    --primary: 243 84% 14%;
    --primary-foreground: 180 4% 99%;
    --secondary: 36 67% 81%; /* #e9ceb0 */
    --secondary-foreground: 243 84% 14%;
    --muted: 36 20% 92%;
    --muted-foreground: 243 10% 40%;
    --accent: 36 67% 81%;
    --accent-foreground: 243 84% 14%;
    --destructive: 0 84% 60%;
    --destructive-foreground: 210 40% 98%;
    --border: 220 13% 91%;
    --input: 214 32% 91%;
    --ring: 243 84% 14%;
    --radius: 0.75rem;

    /* Light mode vibrant artistic enhancements */
    --gradient-primary: linear-gradient(135deg, hsl(243 84% 14%) 0%, hsl(260 70% 25%) 50%, hsl(243 84% 18%) 100%);
    --gradient-secondary: linear-gradient(135deg, hsl(36 67% 81%) 0%, hsl(45 80% 75%) 50%, hsl(36 67% 85%) 100%);
    --gradient-card: linear-gradient(135deg, hsl(180 4% 99%) 0%, hsl(200 15% 96%) 30%, hsl(180 8% 97%) 100%);
    --gradient-background: linear-gradient(135deg, hsl(180 4% 99%) 0%, hsl(200 25% 95%) 50%, hsl(180 10% 98%) 100%);
    --gradient-nav: linear-gradient(135deg, hsl(180 4% 99%) 0%, hsl(210 30% 96%) 50%, hsl(220 20% 98%) 100%);
    --gradient-vibrant: linear-gradient(135deg, hsl(210 100% 88%) 0%, hsl(280 60% 88%) 50%, hsl(25 95% 88%) 100%);
    --gradient-warm: linear-gradient(135deg, hsl(25 95% 92%) 0%, hsl(45 80% 90%) 50%, hsl(60 70% 88%) 100%);
    --gradient-cool: linear-gradient(135deg, hsl(210 100% 92%) 0%, hsl(190 80% 90%) 50%, hsl(170 70% 88%) 100%);
    
    --accent-blue: 210 100% 75%;
    --accent-green: 142 76% 65%;
    --accent-orange: 25 95% 70%;
    --accent-purple: 280 60% 75%;
    --accent-pink: 320 70% 80%;
    --accent-cyan: 180 80% 70%;
    --accent-amber: 45 100% 70%;
    --accent-emerald: 160 75% 65%;
    --shadow-colored: 0 4px 20px hsla(243, 84%, 14%, 0.2), 0 2px 8px hsla(210, 100%, 75%, 0.15);
    --shadow-vibrant: 0 8px 32px hsla(210, 100%, 75%, 0.3), 0 4px 16px hsla(280, 60%, 75%, 0.2);
    --glow-green: 0 0 20px hsla(142, 76%, 65%, 0.6);
    --glow-orange: 0 0 20px hsla(25, 95%, 70%, 0.6);
    --glow-purple: 0 0 20px hsla(280, 60%, 75%, 0.6);
  }

  /* Page-specific: hide scrollbars but keep scrolling (Dashboard, Wakti AI) */
  /* Ensure body itself never shows a scrollbar on Dashboard */
  body.dashboard-page {
    overflow-x: hidden !important;
    overflow-y: auto !important;
  }

  /* PROJECT DETAIL PAGE: Lock body scroll - only chat and iframe scroll */
  body.project-detail-page {
    overflow: hidden !important;
  }

  /* Desktop/tablet layouts use .app-main; keep it locked */
  body.project-detail-page .app-main {
    overflow: hidden !important;
    height: 100% !important;
    max-height: 100% !important;
  }
  body.project-detail-page .app-main > div {
    height: 100% !important;
    max-height: 100% !important;
    overflow: hidden !important;
  }

  /* Mobile layout uses plain <main>. On this page we manage header spacing inside ProjectDetail. */
  @media (max-width: 767px) {
    body.project-detail-page main {
      padding-top: 0 !important;
      padding-bottom: 0 !important;
      height: 100dvh !important;
      overflow: hidden !important;
    }
    body.project-detail-page main > * {
      height: 100% !important;
      overflow: hidden !important;
    }
  }

  /* Hide scrollbar on the actual scroll container */
  .app-main,
  body.dashboard-page .app-main,
  body.wakti-ai-page .app-main,
  body.dashboard-page main,
  body.wakti-ai-page main {
    -ms-overflow-style: none !important; /* IE/Edge legacy */
    scrollbar-width: none !important;    /* Firefox */
  }
  .app-main::-webkit-scrollbar,
  body.dashboard-page .app-main::-webkit-scrollbar,
  body.wakti-ai-page .app-main::-webkit-scrollbar,
  body.dashboard-page main::-webkit-scrollbar,
  body.wakti-ai-page main::-webkit-scrollbar {
    display: none !important;            /* Chrome/Safari/Edge (Chromium) */
    width: 0 !important;
    height: 0 !important;
  }

  /* Force hide any inner scrollbars on Dashboard descendants */
  body.dashboard-page * {
    scrollbar-width: none !important;
  }
  body.dashboard-page *::-webkit-scrollbar {
    display: none !important;
    width: 0 !important;
    height: 0 !important;
  }

  body, html {
    --app-header-h: calc(64px + env(safe-area-inset-top, 0px));
    --app-bottom-tabs-h: calc(64px + env(safe-area-inset-bottom, 0px));
    /* Allow page content to scroll; keep only horizontal hidden */
    overflow-x: hidden;
    overflow-y: visible;
    /* RTL fix - prevent content clipping */
    width: 100%;
    max-width: 100vw;
  }

  /* RTL layout fix - ensure main content doesn't clip */
  main, [dir="rtl"], [dir="ltr"] {
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
  }

  :root {
    /* Desktop sidebar sizes */
    --sidebar-width: 220px;
    --sidebar-mini-width: 70px;
    --desktop-header-h: 60px;
    --tablet-header-h: 56px;
    --tablet-sidebar-width: 180px;
    --tablet-sidebar-mini-width: 60px;
    --tablet-bottom-nav-h: 60px;
    /* Dynamic sidebar widths (updated by JavaScript) */
    --current-sidebar-width: 70px;
    --current-tablet-sidebar-width: 60px;
  }

  .dark {
    /* Dark theme - Enhanced with vibrant artistic touches */
    --background: 222 20% 6%; /* #0c0f14 */
    --foreground: 0 0% 95%;
    --card: 222 20% 6%;
    --card-foreground: 0 0% 95%;
    --popover: 222 20% 6%;
    --popover-foreground: 0 0% 95%;
    --primary: 0 0% 95%;
    --primary-foreground: 222 20% 6%;
    --secondary: 240 1% 38%; /* #606062 */
    --secondary-foreground: 0 0% 95%;
    --muted: 240 3% 30%;
    --muted-foreground: 240 5% 65%;
    --accent: 240 1% 52%; /* #858384 */
    --accent-foreground: 0 0% 95%;
    --destructive: 0 63% 31%;
    --destructive-foreground: 0 0% 95%;
    --border: 240 3% 30%;
    --input: 240 3% 25%;
    --ring: 240 4% 65%;

    /* Dark mode vibrant artistic enhancements */
    --gradient-primary: linear-gradient(135deg, hsl(0 0% 95%) 0%, hsl(210 30% 80%) 30%, hsl(260 40% 75%) 70%, hsl(210 20% 85%) 100%);
    --gradient-secondary: linear-gradient(135deg, hsl(240 1% 38%) 0%, hsl(260 15% 45%) 50%, hsl(240 5% 45%) 100%);
    --gradient-card: linear-gradient(135deg, hsl(222 20% 6%) 0%, hsl(235 25% 8%) 30%, hsl(250 20% 10%) 70%, hsl(222 25% 8%) 100%);
    --gradient-background: linear-gradient(135deg, hsl(222 20% 6%) 0%, hsl(235 25% 7%) 25%, hsl(250 20% 8%) 50%, hsl(260 15% 9%) 75%, hsl(235 20% 8%) 100%);
    --gradient-nav: linear-gradient(135deg, hsl(222 20% 6%) 0%, hsl(240 25% 12%) 50%, hsl(260 20% 15%) 100%);
    --gradient-vibrant: linear-gradient(135deg, hsl(210 100% 60%) 0%, hsl(280 70% 65%) 50%, hsl(25 95% 60%) 100%);
    --gradient-warm: linear-gradient(135deg, hsl(25 85% 55%) 0%, hsl(45 80% 60%) 50%, hsl(60 70% 65%) 100%);
    --gradient-cool: linear-gradient(135deg, hsl(210 100% 60%) 0%, hsl(190 80% 65%) 50%, hsl(170 70% 60%) 100%);
    
    --accent-blue: 210 100% 65%;
    --accent-green: 142 76% 55%;
    --accent-orange: 25 95% 60%;
    --accent-purple: 280 70% 65%;
    --accent-pink: 320 75% 70%;
    --accent-cyan: 180 85% 60%;
    --accent-amber: 45 100% 60%;
    --accent-emerald: 160 80% 55%;
    
    --shadow-colored: 0 4px 32px hsla(0, 0%, 0%, 0.7), 0 2px 16px hsla(210, 100%, 65%, 0.3);
    --shadow-soft: 0 2px 20px hsla(0, 0%, 0%, 0.5), 0 1px 8px hsla(240, 20%, 40%, 0.4);
    --shadow-vibrant: 0 8px 40px hsla(210, 100%, 65%, 0.4), 0 4px 20px hsla(280, 70%, 65%, 0.3);
    --glow-primary: 0 0 40px hsla(210, 100%, 65%, 0.5), 0 0 80px hsla(280, 70%, 65%, 0.3);
    --glow-blue: 0 0 25px hsla(210, 100%, 65%, 0.8);
    --glow-green: 0 0 25px hsla(142, 76%, 55%, 0.8);
    --glow-orange: 0 0 25px hsla(25, 95%, 60%, 0.8);
    --glow-purple: 0 0 25px hsla(280, 70%, 65%, 0.8);
  }
}

/* Ensure form field text is visible in all themes */
input, textarea, select {
  color: hsl(var(--foreground));
  caret-color: hsl(var(--foreground));
}

/* Placeholder contrast */
input::placeholder,
textarea::placeholder {
  color: hsl(var(--muted-foreground));
  opacity: 1; /* avoid extra dimming on some browsers */
}

@keyframes wakti-wave-pulse {
  0% {
    transform: scaleY(0.35);
    filter: hue-rotate(0deg) blur(0px);
    opacity: 0.55;
  }
  45% {
    transform: scaleY(1.05);
    filter: hue-rotate(120deg) blur(1px);
    opacity: 1;
  }
  100% {
    transform: scaleY(0.4);
    filter: hue-rotate(0deg) blur(0px);
    opacity: 0.65;
  }
}

/* Chat mode loading: Wakti logo glow breathe animation */
@keyframes glow-breathe {
  0%, 100% {
    filter: drop-shadow(0 0 6px hsl(210 100% 65% / 0.5));
    transform: scale(1);
  }
  50% {
    filter: drop-shadow(0 0 14px hsl(210 100% 65% / 0.8));
    transform: scale(1.08);
  }
}

.wakti-wave-bar {
  transform-origin: center;
  animation: wakti-wave-pulse 1400ms ease-in-out infinite;
  animation-delay: calc(var(--i, 0) * 55ms);
  will-change: transform, filter, opacity;
}

.dark .wakti-wave-bar {
  box-shadow: 0 0 10px hsla(210, 100%, 65%, 0.25);
}

@media (prefers-reduced-motion: reduce) {
  .wakti-wave-bar {
    animation: none;
  }
}

/* Autofill in dark mode can force light text; normalize it */
.dark input:-webkit-autofill,
.dark textarea:-webkit-autofill,
.dark select:-webkit-autofill {
  -webkit-text-fill-color: hsl(var(--foreground)) !important;
  transition: background-color 100000s ease-in-out 0s; /* neutralize yellow autofill */
}

/* Mobile-specific styles with enhanced artistic touches - FIXED SCROLLING */
@layer base {
  * {
    @apply border-border;
  }
  
  html, body {
    @apply antialiased;
    background: var(--gradient-background);
    /* Use dynamic viewport units that work with mobile keyboards */
    min-height: 100dvh;
    height: auto; /* Changed from 100dvh to auto for Android Chrome scrolling */
    overscroll-behavior-y: contain;
  }

  /* When keyboard is visible, use visual viewport height */
  body.keyboard-visible {
    height: var(--visual-viewport-height, 100vh);
    overflow: hidden;
  }
  
  body {
    @apply text-foreground;
    font-feature-settings: "rlig" 1, "calt" 1;
    background: var(--gradient-background);
  }

  #root {
    @apply min-h-screen;
    background: var(--gradient-background);
    /* Full width for all screen sizes, no mobile constraint */
    width: 100%;
    max-width: none;
    min-height: 100dvh;
    height: auto; /* Changed from 100dvh to auto for Android Chrome scrolling */
  }

  body.keyboard-visible #root {
    height: var(--visual-viewport-height, 100vh);
  }
  
  /* Mobile-specific root styles only for mobile breakpoint */
  @media (max-width: 767px) {
    #root {
      @apply max-w-md mx-auto;
    }
  }

  /* App container with enhanced background */
  .app-container {
    @apply flex flex-col max-w-md w-full mx-auto;
    background: var(--gradient-background);
  }

  /* Mobile container with vibrant gradient - FIXED SCROLLING */
  .mobile-container {
    @apply max-w-md w-full mx-auto flex flex-col overflow-hidden;
    background: var(--gradient-background);
    height: 100dvh;
  }

  .container.keyboard-visible .mobile-container {
    height: var(--visual-viewport-height, 100vh);
  }

  /* Desktop container - full width layout */
  .desktop-container {
    @apply w-full min-h-screen;
    background: var(--gradient-background);
  }

  /* Tablet container - full width layout */
  .tablet-container {
    @apply w-full min-h-screen;
    background: var(--gradient-background);
  }

  /* Enhanced mobile buttons with vibrant gradients */
  .mobile-btn {
    @apply py-3 px-6 text-base rounded-xl font-medium transition-all active:scale-95;
    background: var(--gradient-primary);
    box-shadow: var(--shadow-colored);
    transition: all 0.3s ease;
  }

  .mobile-btn:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: var(--glow-primary), var(--shadow-vibrant);
  }

  /* Solid background utility - for headers and fixed elements */
  .solid-bg {
    background: hsl(var(--background)) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  /* Enhanced mobile header with vibrant gradient */
  .mobile-header {
    @apply sticky top-0 z-10 flex items-center justify-between p-4 border-b;
    background: var(--gradient-nav);
    border-color: hsl(var(--border));
    box-shadow: var(--shadow-soft);
    backdrop-filter: blur(15px);
  }

  /* Mobile safe area (for bottom nav) */
  .safe-area-bottom {
    @apply pb-28;
  }

  /* Enhanced floating navigation with vibrant gradient and glow */
  .floating-nav {
    @apply fixed bottom-5 left-0 right-0 mx-auto max-w-sm z-10;
    @apply flex justify-around py-3 px-4 mx-4 rounded-full;
    background: var(--gradient-nav);
    backdrop-filter: blur(25px);
    border: 1px solid hsl(var(--border));
    box-shadow: var(--shadow-vibrant), var(--glow-primary);
  }

  /* Language specific - RTL support for Arabic */
  .rtl {
    direction: rtl;
    text-align: right;
  }
  
  /* Arabic font support */
  html[lang="ar"],
  html[lang="ar"] * {
    font-family: 'Noto Sans Arabic', 'Segoe UI', 'Tahoma', 'Arial', sans-serif;
  }
  
  /* Ensure proper text rendering for Arabic */
  html[lang="ar"] input,
  html[lang="ar"] textarea,
  html[lang="ar"] select {
    text-align: right;
    direction: rtl;
  }

  /* EXCEPTION: Wakti AI chat textarea should always behave LTR like English */
  html[lang="ar"] .wakti-ai-textarea {
    text-align: left;
    direction: ltr;
  }
  
  /* Fix flexbox direction for RTL */
  html[dir="rtl"] .flex-row {
    flex-direction: row-reverse;
  }
  
  /* Enhanced draggable widgets */
  .widget-draggable {
    touch-action: pan-y; /* Allow vertical scrolling while dragging horizontally */
    user-select: none;
    transition: all 0.3s ease;
  }

  .widget-draggable:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-vibrant);
  }

  /* Enhanced widget styles */
  .calendar-widget {
    @apply rounded-lg border overflow-hidden;
    background: var(--gradient-card);
    border-color: hsl(var(--border));
    box-shadow: var(--shadow-soft);
  }
  
  .events-widget {
    @apply space-y-2;
  }
  
  .event-item {
    @apply flex items-center justify-between p-2 rounded-md transition-all duration-300;
    background: var(--gradient-card);
  }

  .event-item:hover {
    transform: translateX(4px);
    box-shadow: var(--shadow-soft);
  }

  /* Hide scrollbar but keep functionality */
  .scrollbar-hide {
    -ms-overflow-style: none;  /* Internet Explorer 10+ */
    scrollbar-width: none;  /* Firefox */
  }
  
  .scrollbar-hide::-webkit-scrollbar { 
    display: none;  /* Safari and Chrome */
  }

  /* Enhanced card styles with vibrant gradients */
  .enhanced-card {
    background: var(--gradient-card);
    border: 1px solid hsl(var(--border));
    box-shadow: var(--shadow-soft);
    transition: all 0.3s ease;
  }

  .enhanced-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-vibrant);
  }

  /* Button enhancements */
  .btn-enhanced {
    background: var(--gradient-primary);
    box-shadow: var(--shadow-soft);
    transition: all 0.3s ease;
  }

  .btn-enhanced:hover {
    transform: translateY(-1px);
    box-shadow: var(--glow-primary), var(--shadow-vibrant);
  }

  .btn-secondary-enhanced {
    background: var(--gradient-secondary);
    box-shadow: var(--shadow-soft);
    transition: all 0.3s ease;
  }

  .btn-secondary-enhanced:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-vibrant);
  }

  /* Form enhancements */
  .input-enhanced {
    background: var(--gradient-card);
    border: 1px solid hsl(var(--border));
    transition: all 0.3s ease;
    box-shadow: var(--shadow-soft);
  }

  .input-enhanced:focus {
    box-shadow: var(--glow-primary), var(--shadow-soft);
    border-color: hsl(var(--primary));
  }

  /* Status indicators with vibrant enhanced colors */
  .status-success {
    background: linear-gradient(135deg, hsl(var(--accent-green)) 0%, hsl(142 90% 70%) 50%, hsl(142 76% 88%) 100%);
    box-shadow: var(--glow-green);
  }

  .status-warning {
    background: linear-gradient(135deg, hsl(var(--accent-orange)) 0%, hsl(25 100% 75%) 50%, hsl(25 95% 88%) 100%);
    box-shadow: var(--glow-orange);
  }

  .status-info {
    background: linear-gradient(135deg, hsl(var(--accent-blue)) 0%, hsl(210 100% 80%) 50%, hsl(210 100% 88%) 100%);
    box-shadow: var(--glow-blue);
  }

  .status-error {
    background: linear-gradient(135deg, hsl(var(--destructive)) 0%, hsl(0 90% 65%) 50%, hsl(0 84% 55%) 100%);
  }

  /* Typography enhancements */
  .text-enhanced-heading {
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 600;
  }

  .text-shadow-soft {
    text-shadow: 0 2px 4px hsla(0, 0%, 0%, 0.3);
  }

  /* Mobile Navigation Enhancement Classes */
  .nav-icon-calendar {
    color: hsl(var(--accent-blue));
    filter: drop-shadow(0 0 8px hsla(var(--accent-blue), 0.6));
  }

  /* Super-glued mobile navigation */
  .mobile-nav-fixed {
    position: fixed !important;
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    z-index: 2147483647 !important; /* Maximum z-index */
    transform: translateZ(0);
    backface-visibility: hidden;
    -webkit-transform: translate3d(0, 0, 0);
    -webkit-backface-visibility: hidden;
    will-change: transform;
    padding-bottom: env(safe-area-inset-bottom, 0px) !important;
    pointer-events: auto !important;
    touch-action: manipulation; /* Allow scrolling, prevent double-tap zoom */
    user-select: none;
  }

  .nav-icon-maw3d {
    color: hsl(var(--accent-purple));
    filter: drop-shadow(0 0 8px hsla(var(--accent-purple), 0.6));
  }

  .nav-icon-tr {
    color: hsl(var(--accent-green));
    filter: drop-shadow(0 0 8px hsla(var(--accent-green), 0.6));
  }

  .nav-icon-ai {
    color: hsl(var(--accent-orange));
    filter: drop-shadow(0 0 8px hsla(var(--accent-orange), 0.6));
  }

  .nav-icon-tasjeel {
    color: hsl(var(--accent-cyan));
    filter: drop-shadow(0 0 8px hsla(var(--accent-cyan), 0.6));
  }

  .nav-icon-active {
    animation: pulse-color 2s ease-in-out infinite;
    transform: scale(1.1);
  }

  /* 3D look for circular progress gauges */
  .gauge-3d .CircularProgressbar-path {
    filter: drop-shadow(0 2px 6px rgba(0,0,0,0.15));
    stroke-linecap: round;
  }
  .gauge-3d .CircularProgressbar-trail {
    filter: drop-shadow(0 1px 3px rgba(0,0,0,0.08));
    opacity: 0.9;
  }

  /* Ensure anchor jumps and scrollIntoView land below the fixed header */
  html {
    scroll-padding-top: calc(var(--app-header-h) + var(--app-content-gap));
  }

  /* Desktop/Tablet scroll padding for floating headers */
  @media (min-width: 768px) {
    html {
      scroll-padding-top: 140px; /* Account for floating header height + spacing + extra buffer */
    }
  }

  /* When drawer is open, force a visible blur/dim on the app content as a fallback
     (useful on browsers/environments where backdrop-filter is limited). The
     SideSheet is portaled to <body>, so this will not blur the panel itself. */
  html.drawer-blur .app-layout-desktop,
  html.drawer-blur .app-layout-tablet,
  html.drawer-blur #root {
    filter: blur(12px) saturate(115%) brightness(0.95);
    transition: filter 200ms ease;
  }

  /* Chat input may be portaled to body; blur it too when drawer is open */
  html.drawer-blur .chat-input-container {
    filter: blur(12px) saturate(115%) brightness(0.95);
    transition: filter 200ms ease;
  }

  /* Sidebar expanded fallback: blur/dim background while the sidebar is open */
  html.sidebar-blur .app-layout-desktop,
  html.sidebar-blur .app-layout-tablet,
  html.sidebar-blur #root {
    filter: blur(12px) saturate(115%) brightness(0.95);
    transition: filter 200ms ease;
  }

  html.sidebar-blur .chat-input-container {
    filter: blur(12px) saturate(115%) brightness(0.95);
    transition: filter 200ms ease;
  }

  /* Spacing is handled in AppLayout <main> via pt/pb using the variables above */

  /* Mobile keyboard support - proper viewport handling */
  /* App Layout adjustments */
  .app-layout-mobile {
    height: 100%; /* This was the missing piece */
    display: flex;
    flex-direction: column;
  }

  body.keyboard-visible .app-layout-mobile {
    height: var(--visual-viewport-height, 100vh);
  }

  /* Chat input positioning - SOLID & FIXED */
  .chat-input-container {
    position: fixed !important;
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    z-index: 800 !important; /* Keep below SideSheet (>=12010) and header overlays */
    padding-bottom: env(safe-area-inset-bottom, 0px) !important;
    background: var(--background, #111827) !important;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3) !important;
    border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
  }

  /* Ensure solid background for chat input */
  .chat-input-container.solid-bg {
    background: var(--background, #111827) !important;
    border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  /* Ensure chat input stays at bottom and flush with keyboard when visible */
  .wakti-ai-container.keyboard-visible .chat-input-container {
    position: fixed !important;
    bottom: var(--keyboard-height, 0px) !important;
    left: 0 !important;
    right: 0 !important;
    padding-bottom: 0 !important;
    transform: translateY(0) !important;
    z-index: 9999 !important;
    background: var(--background, #111827) !important;
    border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3) !important;
  }

  /* Removed mobile-nav CSS rules - component deleted */

  /* Removed global chat-messages-container rules - causing bottom space pollution */

  /* Utility classes */
  .hide-on-keyboard {
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .wakti-ai-container.keyboard-visible .hide-on-keyboard {
    opacity: 0;
    visibility: hidden;
  }
}

/* WIDGET STYLING - Enhanced liquid glass effects */
.widget, [class*="widget"], [class*="Widget"] {
  position: relative !important;
  overflow: visible !important;
  height: auto !important;
  min-height: auto !important;
  border-radius: 1rem !important;
  background: rgba(255, 255, 255, 0.05) !important;
  backdrop-filter: blur(15px) !important;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  transition: transform 0.2s, box-shadow 0.3s !important;
}

/* Widget hover effect */
.widget:hover, [class*="widget"]:hover, [class*="Widget"]:hover {
  transform: translateY(-2px) !important;
  box-shadow: 0 12px 36px rgba(0, 0, 0, 0.15) !important;
}

/* Widget colors by type */
.TRWidget, [class*="tr-widget"] {
  background: linear-gradient(145deg, rgba(16, 185, 129, 0.05), rgba(239, 68, 68, 0.05)) !important;
  border-color: rgba(16, 185, 129, 0.15) !important;
}

.CalendarWidget, [class*="calendar-widget"] {
  background: linear-gradient(145deg, rgba(59, 130, 246, 0.05), rgba(139, 92, 246, 0.05)) !important;
  border-color: rgba(59, 130, 246, 0.15) !important;
}

.EventsWidget, [class*="events-widget"] {
  background: linear-gradient(145deg, rgba(139, 92, 246, 0.05), rgba(236, 72, 153, 0.05)) !important;
  border-color: rgba(139, 92, 246, 0.15) !important;
}

.QuoteWidget, [class*="quote-widget"] {
  background: linear-gradient(145deg, rgba(139, 92, 246, 0.05), rgba(59, 130, 246, 0.05)) !important;
  border-color: rgba(139, 92, 246, 0.15) !important;
}

/* Properly fix header and other fixed elements */
.chat-input-container, .fixed, [class*="fixed"] {
  position: fixed !important;
}

/* Fix header positioning - mobile gets full width header with SOLID background */
.app-layout-mobile header, .app-layout-mobile .header, .app-layout-mobile [class*="header"] {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  z-index: 100 !important;
  background-color: hsl(var(--background)) !important;
  background: hsl(var(--background)) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  height: var(--app-header-h, 56px) !important;
  border-bottom: 1px solid hsl(var(--border)) !important;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3) !important;
}

/* Ensure AppHeader is solid only on smaller screens */
@media (max-width: 768px) {
  header.app-header-fixed,
  .app-header-fixed {
    background: hsl(var(--background)) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
}

/* Desktop header - account for sidebar and fixed positioning */
.app-layout-desktop header, .app-layout-desktop .header,
.app-layout-tablet header, .app-layout-tablet .header {
  position: fixed !important;
  top: 1rem !important;
  left: calc(var(--current-sidebar-width, var(--sidebar-width, 240px)) + 1rem) !important; /* Match sidebar inset */
  right: 1rem !important;
  z-index: 999 !important;
  background-color: transparent !important;
  background: transparent !important;
  height: var(--app-header-h, 56px) !important;
  width: calc(100% - var(--current-sidebar-width, var(--sidebar-width, 240px)) - 2rem) !important; /* Match sidebar inset */
}

/* Ensure the DesktopHeader container itself is fixed */
.app-layout-desktop header > div, 
.app-layout-desktop .header > div,
.app-layout-tablet header > div, 
.app-layout-tablet .header > div {
  position: relative !important;
  z-index: 110 !important;
}

/* Fixed header styling */
.fixed-header {
  position: fixed !important;
  top: 1rem !important;
  z-index: 999 !important;
  width: calc(100% - var(--current-sidebar-width, var(--sidebar-width, 240px)) - 2rem) !important;
  left: calc(var(--current-sidebar-width, var(--sidebar-width, 240px)) + 1rem) !important;
  right: 1rem !important;
  pointer-events: auto !important;
  margin: 0 !important;
  padding: 0 !important;
}

/* Tablet fixed header adjustment */
.app-layout-tablet .fixed-header {
  width: calc(100% - var(--current-sidebar-width, var(--sidebar-width, 240px)) - 2rem) !important;
  left: calc(var(--current-sidebar-width, var(--sidebar-width, 240px)) + 1rem) !important;
}

/* Make containers responsive to screen size */
@media (min-width: 768px) {
  /* Desktop/Tablet Main Layouts */
  .app-layout-desktop, .app-layout-tablet {
    width: 100% !important;
    max-width: 100vw !important;
    overflow-x: hidden !important;
  }

  /* WaktiAIV2 container responsive sizing */
  .app-layout-desktop .wakti-ai-container, 
  .app-layout-tablet .wakti-ai-container {
    width: 100% !important;
    max-width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
  }
  
  /* Fix container width for Wakti AI chat input */
  .app-layout-desktop .chat-input-container,
  .app-layout-tablet .chat-input-container {
    width: calc(100% - var(--current-sidebar-width, var(--sidebar-width, 240px)) - 1.5rem) !important;
    left: calc(var(--current-sidebar-width, var(--sidebar-width, 240px)) + 0.5rem) !important;
    right: 1rem !important;
    margin: 0 !important;
  }
  
  /* Make ChatInput match the container width and style on desktop/tablet */
  @media (min-width: 768px) {
    .app-layout-desktop .chat-input-container .w-full,
    .app-layout-tablet .chat-input-container .w-full {
      max-width: 100% !important;
      width: 100% !important;
      margin: 0 auto !important;
      border-radius: 1rem !important;
    }
    
    /* Match the 3D effect and styling */
    .app-layout-desktop .chat-input-container.solid-bg,
    .app-layout-tablet .chat-input-container.solid-bg {
      background-color: hsl(var(--background)) !important;
      border-top: 1px solid rgba(0, 0, 0, 0.08) !important;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.08) !important;
      padding: 1rem 0 0 0 !important;
    }
    
    /* Enhanced 3D effect for the chat input itself on desktop */
    .app-layout-desktop .chat-input-container [class*="border-blue-400"],
    /* Mobile: keep the input opaque as well */
    .app-layout-mobile .chat-input-container.solid-bg {
      background-color: hsl(var(--background)) !important;
      border-top: 1px solid rgba(0, 0, 0, 0.08) !important;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.08) !important;
      padding-top: 0.75rem !important; /* slight space for the center handle */
    }

    .app-layout-tablet .chat-input-container [class*="border-blue-400"] {
      border: 1px solid rgba(255, 255, 255, 0.2) !important;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25),
                0 0 0 1px rgba(255, 255, 255, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 8px 32px rgba(0, 0, 0, 0.12) !important;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 50%, rgba(255, 255, 255, 0.1) 100%), var(--gradient-background) !important;
      backdrop-filter: blur(20px) !important;
      -webkit-backdrop-filter: blur(20px) !important;
    }
    
    /* Make ChatMessages full width */
    .chat-messages-wrapper {
      width: 100% !important;
      max-width: 100% !important;
      padding-left: 0 !important;
      padding-right: 0 !important;
    }
    
    /* Remove max-width constraints for all containers */
    .max-w-6xl,
    .wakti-ai-container .max-w-6xl,
    .app-layout-desktop .wakti-ai-container .max-w-6xl,
    .app-layout-tablet .wakti-ai-container .max-w-6xl {
      width: 100% !important;
      max-width: 100% !important;
      margin-left: 0 !important;
      margin-right: 0 !important;
    }
  }
}

/* For tablet, use tablet sidebar width */
.app-layout-tablet header, .app-layout-tablet .header {
  left: var(--tablet-sidebar-width, 180px) !important;
  width: calc(100% - var(--tablet-sidebar-width, 180px) - 1.5rem) !important; /* Set explicit width */
}

/* Tablet-specific Wakti AI container width */
@media (min-width: 768px) and (max-width: 1023px) {
  .app-layout-tablet .wakti-ai-container {
    max-width: calc(100% - var(--tablet-sidebar-width, 180px) - 1.5rem) !important;
    margin-left: calc(var(--tablet-sidebar-width, 180px) + 0.5rem) !important;
  }
  
  .app-layout-tablet .chat-input-container {
    width: calc(100% - var(--tablet-sidebar-width, 180px) - 1.5rem) !important;
    left: calc(var(--tablet-sidebar-width, 180px) + 0.5rem) !important;
  }
}


/* --- THE GREAT SIMPLIFICATION --- */

/* 1. GLOBAL SETUP: FORCE SCROLLING - especially for Honor phones */
html {
  overflow-x: hidden !important;
  overflow-y: scroll !important; /* FORCE scroll mode */
  height: 100% !important;
  position: relative !important;
}

body {
  overflow-x: hidden !important;
  overflow-y: scroll !important; /* FORCE scroll mode */
  height: auto !important; /* Allow expansion */
  min-height: 100% !important;
  position: relative !important;
}

#root {
  overflow-x: hidden !important;
  overflow-y: visible !important; /* Let body handle scroll */
  height: auto !important; /* Allow expansion */
  min-height: 100% !important;
}

/* 2. DEFAULT LAYOUT: For APP pages that use <main> (Dashboard, etc) - NOT public pages */
/* Only apply to pages inside AppLayout, not public landing pages */
.app-layout-mobile main,
.app-layout-desktop main,
.app-layout-tablet main {
  overflow-y: auto !important;
  overflow-x: hidden !important;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior-y: contain;
  height: 100% !important;
  /* Add space for fixed header and bottom nav */
  padding-top: var(--app-header-h) !important;
  padding-bottom: var(--app-bottom-tabs-h) !important;
}

/* Wakti AI: use main as scroller but reserve input space */
body.wakti-ai-page main {
  padding-bottom: 0 !important;
}

/* PUBLIC PAGES (Home, Login, etc): Let body scroll naturally, no fixed main height */
body.public-page main,
body.public-page .min-h-screen main,
body.public-page div main {
  height: auto !important;
  overflow: visible !important;
  overflow-y: visible !important;
  padding-top: 0 !important;
  padding-bottom: 0 !important;
}

/* Also ensure parent containers don't trap scroll on public pages */
body.public-page,
body.public-page #root,
body.public-page #root > div {
  overflow: visible !important;
  overflow-y: visible !important;
  height: auto !important;
}

/* 3. WAKTI AI PAGE LAYOUT: This page is special and does NOT use <main>. */
.wakti-ai-page-container {
  /* Let <main> be the only scroller. Do not create a nested scroller here. */
  overflow: visible !important;
  height: auto !important;
  /* No extra padding here to avoid double spacing with main */
  padding-top: 0 !important;
  padding-bottom: 0 !important;
}

/* Desktop: smaller reserve so the visible gap is tiny */
@media (min-width: 1024px) {
  body.wakti-ai-page main {
    padding-bottom: 0 !important;
  }
}

/* 4. CHAT INPUT: This is fixed to the bottom and MUST be solid. */
.chat-input-container {
  position: fixed !important;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  padding-bottom: env(safe-area-inset-bottom, 0px);
  /* Force a solid background */
  background: var(--gradient-background) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  box-shadow: 0 -2px 10px rgba(0,0,0,0.1) !important;
  border-top: 1px solid rgba(128,128,128,0.2) !important;
}

/* When portaled to <body>, still align with sidebar widths on larger screens */
@media (min-width: 1024px) {
  .chat-input-container {
    left: calc(var(--current-sidebar-width, var(--sidebar-width, 220px)) + 1rem) !important;
    right: 1rem !important;
    width: calc(100% - var(--current-sidebar-width, var(--sidebar-width, 220px)) - 2rem) !important;
  }
}

@media (min-width: 768px) and (max-width: 1023px) {
  .chat-input-container {
    left: calc(var(--tablet-sidebar-width, 180px) + 0.5rem) !important;
    right: 1rem !important;
    width: calc(100% - var(--tablet-sidebar-width, 180px) - 1.5rem) !important;
  }
}

/* Fix MobileSlideDownNav rendering and positioning */
.mobile-slide-nav-backdrop {
  position: fixed;
  inset: 0;
  z-index: 1000;
  background: rgba(0, 0, 0, 0.3);
  -webkit-backdrop-filter: blur(8px);
  backdrop-filter: blur(8px);
}

.mobile-slide-nav-container {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1001;
  display: flex;
  flex-direction: column;
  max-height: 80vh;
  overflow: hidden;
}

/* Mobile specific dashboard container styles */
.app-layout-mobile .dashboard-container {
  max-width: 100% !important;
  width: 100% !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
  margin-left: 0 !important;
  margin-right: 0 !important;
  overflow: visible !important;
  height: auto !important;
}

/* Emergency scroll fix class */
.force-scroll {
  overflow: auto !important;
  overflow-y: auto !important;
  height: auto !important;
  min-height: 100% !important;
  position: static !important;
  padding: 0 !important;
  margin: 0 !important;
}

body.keyboard-visible {
  /* Clear out any lingering issues */
  overflow: visible !important;
  height: auto !important;
  min-height: 100% !important;
}

/* PWA standalone adjustments: lock viewport height and disable overscroll bounce */
@media (display-mode: standalone) {
  html, body {
    height: 100svh;
    min-height: 100svh;
    overscroll-behavior: none;
    overscroll-behavior-y: none;
  }
  #root {
    min-height: 100svh;
  }
}

/* Improve iOS tap reliability and remove highlight */
.touch-manipulation {
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

/* === Theme toggle (AppHeader) === */
.theme-toggle {
  --track-width: 110px;
  --track-height: 45px;
  --track-radius: calc(var(--track-height) / 2);
  --thumb-size: 34px;
  --thumb-offset: 6px;
  --cloud-size: calc(var(--track-height) * 0.45);
  --cloud-left: calc(var(--track-height) * 0.15);
  --cloud-bottom: calc(var(--track-height) * -0.35);
  --star-size: calc(var(--track-height) * 0.22);
  --star-gap: calc(var(--track-height) * 0.08);
  --stars-left: calc(var(--track-height) * 0.18);
  --stars-top: calc(var(--track-height) * -0.7);
  --moon-crater-lg: calc(var(--thumb-size) * 0.4);
  --moon-crater-md: calc(var(--thumb-size) * 0.26);
  --moon-crater-sm: calc(var(--thumb-size) * 0.18);
  --moon-crater-lg-left: calc(var(--thumb-size) * 0.2);
  --moon-crater-lg-top: calc(var(--thumb-size) * 0.4);
  --moon-crater-md-left: calc(var(--thumb-size) * 0.68);
  --moon-crater-md-top: calc(var(--thumb-size) * 0.58);
  --moon-crater-sm-left: calc(var(--thumb-size) * 0.54);
  --moon-crater-sm-top: calc(var(--thumb-size) * 0.24);
  --day-bg: #3d7eae;
  --night-bg: #1d1f2c;
  --cloud-color: #f3fdff;
  --cloud-glow: #aacadf;
  --sun-color: #ecca2f;
  --sun-highlight: rgba(254, 255, 239, 0.61);
  --sun-shadow: #a1872a;
  --moon-color: #c4c9d1;
  --moon-shadow: #969696;
  --crater-color: #959db1;
  --transition: 0.5s cubic-bezier(0, -0.02, 0.4, 1.25);
  --thumb-transition: 0.35s cubic-bezier(0, -0.02, 0.35, 1.17);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  position: relative;
}

.theme-toggle,
.theme-toggle *,
.theme-toggle *::before,
.theme-toggle *::after {
  box-sizing: border-box;
}

.theme-toggle__checkbox {
  display: none;
}

.theme-toggle__track {
  width: var(--track-width);
  height: var(--track-height);
  border-radius: var(--track-radius);
  background: var(--day-bg);
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: flex-start;
  overflow: hidden;
  box-shadow:
    0px -3px 4px rgba(0, 0, 0, 0.25),
    0px 3px 6px rgba(255, 255, 255, 0.94),
    inset 0px 3px 6px rgba(0, 0, 0, 0.2),
    inset 0px -3px 6px rgba(0, 0, 0, 0.18);
  transition: var(--transition);
}

.theme-toggle__background {
  position: absolute;
  inset: 0;
  border-radius: inherit;
  overflow: hidden;
  pointer-events: none;
}

.theme-toggle__clouds {
  position: absolute;
  width: var(--cloud-size);
  height: var(--cloud-size);
  left: var(--cloud-left);
  bottom: var(--cloud-bottom);
  border-radius: 999px;
  background: var(--cloud-color);
  box-shadow:
    calc(var(--cloud-size) * 1.1) calc(var(--cloud-size) * 0.35) var(--cloud-color),
    calc(var(--cloud-size) * -0.35) calc(var(--cloud-size) * -0.35) var(--cloud-glow),
    calc(var(--cloud-size) * 1.5) calc(var(--cloud-size) * 0.4) var(--cloud-color),
    calc(var(--cloud-size) * 0.55) calc(var(--cloud-size) * -0.12) var(--cloud-glow),
    calc(var(--cloud-size) * 2.3) 0 var(--cloud-color),
    calc(var(--cloud-size) * 1.3) calc(var(--cloud-size) * -0.08) var(--cloud-glow),
    calc(var(--cloud-size) * 3) calc(var(--cloud-size) * 0.32) var(--cloud-color),
    calc(var(--cloud-size) * 2.1) calc(var(--cloud-size) * -0.32) var(--cloud-glow),
    calc(var(--cloud-size) * 3.6) calc(var(--cloud-size) * -0.05) var(--cloud-color),
    calc(var(--cloud-size) * 2.6) 0 var(--cloud-glow),
    calc(var(--cloud-size) * 4.5) calc(var(--cloud-size) * -0.3) var(--cloud-color),
    calc(var(--cloud-size) * 3.3) calc(var(--cloud-size) * -0.42) var(--cloud-glow),
    calc(var(--cloud-size) * 4.6) calc(var(--cloud-size) * -1.7) 0 calc(var(--cloud-size) * 0.4) var(--cloud-color),
    calc(var(--cloud-size) * 4) calc(var(--cloud-size) * -0.6) var(--cloud-glow),
    calc(var(--cloud-size) * 4.2) calc(var(--cloud-size) * -2.1) 0 calc(var(--cloud-size) * 0.4) var(--cloud-glow);
  transition: var(--transition);
}

.theme-toggle__stars {
  position: absolute;
  top: var(--stars-top);
  left: var(--stars-left);
  width: calc(var(--star-size) * 4.5);
  display: flex;
  gap: var(--star-gap);
  color: #fff;
  transition: var(--transition);
  filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.9));
}

.theme-toggle__star {
  width: var(--star-size);
  height: var(--star-size);
  background: currentColor;
  border-radius: 50%;
  opacity: 0.9;
}

.theme-toggle__star:nth-child(2) {
  width: calc(var(--star-size) * 0.8);
  height: calc(var(--star-size) * 0.8);
  margin-top: calc(var(--star-size) * 0.75);
  opacity: 0.75;
}

.theme-toggle__star:nth-child(3) {
  width: calc(var(--star-size) * 0.7);
  height: calc(var(--star-size) * 0.7);
  margin-top: calc(var(--star-size) * -0.35);
  opacity: 0.62;
}

.theme-toggle__thumb {
  position: absolute;
  left: var(--thumb-offset);
  top: calc((var(--track-height) - var(--thumb-size)) / 2);
  width: var(--thumb-size);
  height: var(--thumb-size);
  border-radius: 999px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: var(--thumb-transition);
  filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.25));
  overflow: hidden;
  pointer-events: none;
}

.theme-toggle__sun {
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: var(--sun-color);
  box-shadow:
    inset 0.062em 0.062em 0 var(--sun-highlight),
    inset 0em -0.062em 0 var(--sun-shadow),
    0 0.125em 0.125em rgba(0, 0, 0, 0.25);
  transition: var(--transition);
}

.theme-toggle__moon {
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: var(--moon-color);
  box-shadow:
    inset 0.062em 0.062em 0 var(--sun-highlight),
    inset 0em -0.062em 0 var(--moon-shadow);
  transform: translateX(100%);
  transition: var(--transition);
}

.theme-toggle__crater {
  position: absolute;
  border-radius: 999px;
  background: var(--crater-color);
  box-shadow: inset 0 0.031em 0.062em rgba(0, 0, 0, 0.25);
}

.theme-toggle__crater--lg {
  width: var(--moon-crater-lg);
  height: var(--moon-crater-lg);
  top: var(--moon-crater-lg-top);
  left: var(--moon-crater-lg-left);
}

.theme-toggle__crater--md {
  width: var(--moon-crater-md);
  height: var(--moon-crater-md);
  top: var(--moon-crater-md-top);
  left: var(--moon-crater-md-left);
}

.theme-toggle__crater--sm {
  width: var(--moon-crater-sm);
  height: var(--moon-crater-sm);
  top: var(--moon-crater-sm-top);
  left: var(--moon-crater-sm-left);
}

@media (max-width: 768px) {
  .theme-toggle {
    --track-width: 44px;
    --track-height: 25px;
    --thumb-size: 18px;
    --thumb-offset: 3px;
  }
}

.theme-toggle__checkbox:checked + .theme-toggle__track {
  background: var(--night-bg);
}

.theme-toggle__checkbox:checked + .theme-toggle__track .theme-toggle__thumb {
  left: calc(var(--track-width) - var(--thumb-size) - var(--thumb-offset));
}

.theme-toggle__checkbox:checked + .theme-toggle__track .theme-toggle__sun {
  opacity: 0;
}

.theme-toggle__checkbox:checked + .theme-toggle__track .theme-toggle__moon {
  transform: translateX(0);
}

.theme-toggle__checkbox:checked + .theme-toggle__track .theme-toggle__clouds {
  bottom: -4em;
}

.theme-toggle__checkbox:checked + .theme-toggle__track .theme-toggle__stars {
  top: 50%;
  transform: translateY(-50%);
}

/* iOS-specific: reduce heavy blur on fixed bars to avoid jank/freezes */
@supports (-webkit-touch-callout: none) {
  .ios-reduce-blur {
    -webkit-backdrop-filter: none !important;
    backdrop-filter: none !important;
  }
}

/* Super-glue fixed bars to the viewport on iOS */
.glue-fixed {
  position: fixed !important;
  transform: translateZ(0); /* create its own compositor layer */
  backface-visibility: hidden;
  will-change: transform;
  contain: layout style size; /* isolate layout calculations */
  /* iOS-specific: Force fixed positioning relative to initial viewport */
  -webkit-transform: translate3d(0, 0, 0);
  -webkit-backface-visibility: hidden;
  -webkit-perspective: 1000;
}

/* iOS Safari: Force header to stay at absolute top during keyboard */
@supports (-webkit-touch-callout: none) {
  .glue-top {
    position: fixed !important;
    top: env(safe-area-inset-top, 0px) !important;
    left: 0 !important;
    right: 0 !important;
    /* Force viewport-relative positioning */
    transform: translate3d(0, 0, 1000px) !important;
  }
  
  .glue-bottom {
    position: fixed !important;
    bottom: env(safe-area-inset-bottom, 0px) !important;
    left: 0 !important;
    right: 0 !important;
    /* Force viewport-relative positioning */
    transform: translate3d(0, 0, 1000px) !important;
  }
}

.glue-top {
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
}

.glue-bottom {
  bottom: 0 !important;
  left: 0 !important;
  right: 0 !important;
}

.glue-z {
  z-index: 2147480000 !important; /* extremely high to sit above any content */
}

/* Option B: Hard overrides for the fixed AppHeader on mobile/PWA */
.app-header-fixed {
  position: fixed !important;
  top: env(safe-area-inset-top, 0px) !important;
  left: 0 !important;
  right: 0 !important;
  z-index: 2147480000 !important;
  transform: none !important;
  -webkit-transform: none !important;
  contain: none !important;
  backface-visibility: visible !important;
  -webkit-backface-visibility: visible !important;
  perspective: none !important;
  -webkit-perspective: none !important;
}

@supports (-webkit-touch-callout: none) {
  .app-header-fixed {
    position: fixed !important;
    top: env(safe-area-inset-top, 0px) !important;
    left: 0 !important;
    right: 0 !important;
    transform: none !important;
    -webkit-transform: none !important;
    contain: none !important;
  }
}

@media (display-mode: standalone) {
  .app-header-fixed {
    position: fixed !important;
    top: env(safe-area-inset-top, 0px) !important;
    left: 0 !important;
    right: 0 !important;
    transform: none !important;
    -webkit-transform: none !important;
    contain: none !important;
  }
}

/* Dark mode styles with enhanced vibrant visuals */
.dark #root {
  background: var(--gradient-background);
}

.dark .enhanced-card {
  background: var(--gradient-card);
  border-color: hsl(var(--border));
}

.dark .floating-nav {
  background: var(--gradient-nav);
  box-shadow: var(--shadow-vibrant), var(--glow-primary);
}

/* Light mode styles with enhanced vibrant visuals */
:root:not(.dark) #root {
  background: var(--gradient-background);
}

:root:not(.dark) .enhanced-card {
  background: var(--gradient-card);
  border-color: hsl(var(--border));
}

:root:not(.dark) .floating-nav {
  box-shadow: var(--shadow-soft), var(--glow-primary);
}

/* --- AI Image Loading Enhancements --- */
@layer components {
  /* ===== Journal 3D utilities (strong) ===== */
  .card-3d {
    position: relative;
    border-radius: 1rem;
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.0)), var(--gradient-card);
    border: 1px solid hsl(var(--border));
    box-shadow:
      0 18px 38px rgba(0,0,0,0.25), /* outer */
      0 4px 12px rgba(0,0,0,0.12),
      inset 0 1px 0 rgba(255,255,255,0.20); /* inner highlight */
  }

  .card-3d.inner-bevel::before {
    content: "";
    position: absolute;
    inset: 1px;
    border-radius: calc(1rem - 1px);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.25);
    pointer-events: none;
  }

  .card-3d.edge-liquid::after {
    content: "";
    position: absolute;
    inset: -2px;
    border-radius: calc(1rem + 2px);
    background: radial-gradient(120% 120% at 0% 0%, rgba(236,72,153,0.18), rgba(59,130,246,0.10) 35%, rgba(255,255,255,0) 70%);
    filter: blur(8px);
    opacity: 0.8;
    pointer-events: none;
  }

  .chip-3d {
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.00));
    border: 1px solid hsl(var(--border));
    box-shadow: 0 6px 14px rgba(0,0,0,0.14), inset 0 1px 0 rgba(255,255,255,0.2);
    transition: transform 150ms ease, box-shadow 200ms ease, background-color 150ms ease;
  }
  .chip-3d:hover { transform: translateY(-1px); box-shadow: 0 8px 18px rgba(0,0,0,0.18), inset 0 1px 0 rgba(255,255,255,0.25); }
  .chip-3d:active { transform: translateY(0); box-shadow: 0 4px 10px rgba(0,0,0,0.14), inset 0 1px 0 rgba(255,255,255,0.2); }
  .chip-3d.active { box-shadow: 0 10px 22px rgba(236,72,153,0.25), inset 0 1px 0 rgba(255,255,255,0.28); border-color: rgba(236,72,153,0.45); }

  .mood-3d.active { box-shadow: 0 0 18px rgba(236,72,153,0.35); }

  .tiny-progress::after {
    content: "";
    position: absolute;
    inset: 0 auto 0 -35%;
    width: 35%;
    background: linear-gradient(90deg, hsl(var(--accent-orange)) 0%, hsl(var(--accent-purple)) 100%);
    border-radius: inherit;
    animation: progress-run 1.15s ease-in-out infinite;
  }

  @keyframes progress-run {
    0% { transform: translateX(0%); }
    100% { transform: translateX(300%); }
  }

  /* Brush-like skeleton placeholder */
  .brush-skeleton {
    position: relative;
    background: linear-gradient(90deg, rgba(0,0,0,0.02) 0%, rgba(0,0,0,0.05) 50%, rgba(0,0,0,0.02) 100%);
    background-size: 200% 100%;
    animation: brush-sweep 1.6s ease-in-out infinite;
  }

  .brush-skeleton::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    background-image:
      repeating-linear-gradient( -10deg,
        rgba(255,255,255,0.0) 0px,
        rgba(255,255,255,0.0) 10px,
        rgba(255,255,255,0.12) 11px,
        rgba(255,255,255,0.12) 18px
      );
    mix-blend-mode: overlay;
  }

  @keyframes brush-sweep {
    0% { background-position: -100% 0; }
    100% { background-position: 200% 0; }
  }

  /* Blur-to-sharp reveal for final image */
  .img-blur-reveal {
    filter: blur(12px) brightness(1.1);
    animation: blur-reveal 650ms ease-out forwards;
  }

  @keyframes blur-reveal {
    0% { filter: blur(12px) brightness(1.1); }
    100% { filter: blur(0) brightness(1); }
  }

  /* Top-to-bottom wipe overlay during saving stage */
  .reveal-wipe {
    position: absolute;
    inset: 0;
    pointer-events: none;
    background: linear-gradient(180deg, rgba(255,255,255,0.85) 0%, rgba(255,255,255,0.35) 35%, rgba(255,255,255,0) 70%);
    mix-blend-mode: screen;
    animation: wipe-down 650ms ease-in-out forwards;
  }

  @keyframes wipe-down {
    0% { transform: translateY(-100%); opacity: 0.9; }
    100% { transform: translateY(100%); opacity: 0; }
  }
}

/* removed: forced visibility for #mobile-nav which interfered with keyboard-hide behavior */

/* DEV: shift nav up on desktop-pointer devices to avoid preview overlay bars */
@media (hover: hover) and (pointer: fine) {
  #mobile-nav.dev-shift-up {
    bottom: 80px !important;
  }
}

/* Hint the browser to use light-themed native controls in light mode */
:root {
  color-scheme: light;
}

/* Critically: enable dark-themed native form controls (select dropdown, date, etc.) */
.dark {
  color-scheme: dark;
}

/* Dark mode: force readable backgrounds and text for form fields */
.dark input:not([type="checkbox"]):not([type="radio"]),
.dark textarea,
.dark select {
  background-color: hsl(var(--card));
  color: hsl(var(--foreground));
  border-color: hsl(var(--border));
}

/* Dark mode: ensure native option/optgroup colors are readable */
.dark select option,
.dark select optgroup {
  background-color: hsl(var(--popover));
  color: hsl(var(--foreground));
}

  /* iOS specific fixes */
  @supports (-webkit-touch-callout: none) {
  html, body {
    position: static; /* was fixed: blocked scrolling */
    overflow-y: auto; /* Changed from visible to auto for scrolling */
    overflow-x: hidden;
    width: 100%;
    height: auto; /* Changed from 100dvh to auto */
    min-height: 100dvh;
  }

  body.keyboard-visible {
    height: var(--visual-viewport-height, 100vh);
  }

  #root {
    position: relative;
    overflow-y: auto; /* Changed from visible to auto */
    overflow-x: hidden;
    width: 100%;
    height: auto; /* Changed from 100dvh to auto */
    min-height: 100dvh;
  }
  body.keyboard-visible #root {
    height: var(--visual-viewport-height, 100vh);
  }

/* End of second @layer base block */
}

/* FINAL OPAQUE OVERRIDES  ensure header and chat input are solid everywhere */
.app-layout-mobile header,
.app-layout-mobile .header {
  background: hsl(var(--background)) !important;
  background-color: hsl(var(--background)) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

.chat-input-container {
  background: hsl(var(--background)) !important;
  background-color: hsl(var(--background)) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  border-top: 1px solid rgba(0,0,0,0.08) !important;
  box-shadow: 0 -2px 10px rgba(0,0,0,0.08) !important;
  border-top-left-radius: 1rem !important;
  border-top-right-radius: 1rem !important;
  overflow: hidden !important; /* clean rounded top */
  isolation: isolate !important; /* create new stacking context to avoid backdrop bleed */
}

/* Solid overlay underneath all children to guarantee opacity */
.chat-input-container::before {
  content: "";
  position: absolute;
  inset: 0;
  background: hsl(var(--background));
  z-index: 0;
}

.chat-input-container > * {
  position: relative;
  z-index: 1;
}

/* Force the inner ChatInput card to be solid (no glass/blur) */
.chat-input-container .group {
  background: hsl(var(--card, var(--background))) !important;
  background-color: hsl(var(--card, var(--background))) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

.wakti-ai-page-container {
  background: hsl(var(--background)) !important;
}

/* Strengthen: kill any glass/translucency inside the ChatInput on all themes */
.chat-input-container [class*="backdrop-blur"],
.chat-input-container [class*="backdrop-filter"],
.chat-input-container .ios-reduce-blur {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

  /* Override Tailwind translucent utility classes used by ChatInput */
  .chat-input-container .bg-white\/40,
  .chat-input-container .dark\:bg-black\/30 {
    background-color: hsl(var(--card, var(--background))) !important;
  }

/* ===== WAKTI JOURNAL  Visual Polish (Option B) ===== */
@layer components {
  .glass-hero {
    border-radius: 1.5rem;
    background: linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.04)), var(--gradient-background);
    border: 1px solid rgba(255,255,255,0.18);
    box-shadow: 0 28px 56px -14px rgba(0,0,0,0.35), 0 0 0 1px rgba(255,255,255,0.06), inset 0 1px 0 rgba(255,255,255,0.2);
    backdrop-filter: blur(18px);
  }

  .journal-card {
    border-radius: 1.25rem;
    background: linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0.04)), var(--gradient-card);
    border: 1px solid rgba(255,255,255,0.18);
    box-shadow: 0 18px 44px -12px rgba(0,0,0,0.28), 0 0 0 1px rgba(255,255,255,0.05), inset 0 1px 0 rgba(255,255,255,0.12);
  }

  .journal-tabs .radix-tabs-trigger[data-state="active"],
  .journal-tabs [data-state="active"] {
    box-shadow: 0 10px 24px rgba(236,72,153,0.35);
  }

  .mood-face {
    transition: transform 200ms ease, box-shadow 250ms ease, background-color 200ms ease;
    border-radius: 0.75rem;
    padding: 8px 10px;
  }
  .mood-face:hover { transform: translateY(-2px) scale(1.06); }
  .mood-face.active { transform: scale(1.08); box-shadow: 0 6px 22px rgba(236,72,153,0.45); background: rgba(255,255,255,0.05); }

  .tag-chip {
    transition: all 200ms ease;
    border-radius: 9999px;
    border: 1px solid hsl(var(--border));
    background: rgba(255,255,255,0.04);
  }
  .tag-chip.active {
    background: linear-gradient(135deg, rgba(236,72,153,0.25), rgba(59,130,246,0.18));
    border-color: rgba(236,72,153,0.45);
    box-shadow: 0 6px 20px rgba(236,72,153,0.35);
  }

  .btn-shine {
    position: relative; overflow: hidden;
  }
  .btn-shine::after {
    content: ""; position: absolute; top: -120%; left: -50%; width: 60%; height: 300%;
    background: linear-gradient(120deg, rgba(255,255,255,0.0) 0%, rgba(255,255,255,0.45) 50%, rgba(255,255,255,0.0) 100%);
    transform: rotate(25deg); opacity: 0; pointer-events: none;
  }
  .btn-shine[data-saving="true"]::after { animation: shine-pass 900ms ease-in-out forwards; }
  @keyframes shine-pass { 0% { left: -60%; opacity: 0.0; } 20% {opacity: 0.9;} 100% { left: 140%; opacity: 0; } }

  /* ===== 3D POP-UP BUTTON WITH REFLECTIVE BORDER & STATIC GLOW ===== */
  .btn-3d-pop {
    position: relative;
    transform: translateY(0) translateZ(0);
    transform-style: preserve-3d;
    box-shadow: 
      0 4px 6px -1px rgba(0, 0, 0, 0.2),
      0 8px 16px -4px rgba(0, 0, 0, 0.15),
      0 12px 24px -8px rgba(99, 102, 241, 0.25),
      inset 0 1px 0 rgba(255, 255, 255, 0.3),
      inset 0 -1px 0 rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.25);
    overflow: hidden;
  }
  .btn-3d-pop::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: linear-gradient(135deg, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.3) 100%);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    pointer-events: none;
  }
  .btn-3d-pop::after {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(
      45deg,
      transparent 40%,
      rgba(255, 255, 255, 0.08) 45%,
      rgba(255, 255, 255, 0.15) 50%,
      rgba(255, 255, 255, 0.08) 55%,
      transparent 60%
    );
    animation: static-shimmer 4s ease-in-out infinite;
    pointer-events: none;
  }
  @keyframes static-shimmer {
    0%, 100% { transform: translateX(-30%) translateY(-30%) rotate(45deg); opacity: 0.6; }
    50% { transform: translateX(30%) translateY(30%) rotate(45deg); opacity: 1; }
  }
  .btn-3d-pop:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 
      0 8px 12px -2px rgba(0, 0, 0, 0.25),
      0 16px 32px -8px rgba(99, 102, 241, 0.35),
      0 0 40px rgba(139, 92, 246, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.4);
  }

  /* ===== 3D POP-UP SECTION WITH DEPTH ===== */
  .section-3d-pop {
    position: relative;
    transform: translateZ(0);
    transform-style: preserve-3d;
    box-shadow: 
      0 10px 40px -10px rgba(0, 0, 0, 0.15),
      0 20px 60px -20px rgba(99, 102, 241, 0.1);
  }
  .section-3d-pop::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: linear-gradient(180deg, rgba(255,255,255,0.08) 0%, transparent 30%, transparent 70%, rgba(0,0,0,0.03) 100%);
    pointer-events: none;
  }

  /* ===== 3D CARD WITH REFLECTIVE BORDER & GLOW ===== */
  .card-3d-pop {
    position: relative;
    transform: translateY(0) translateZ(0);
    transform-style: preserve-3d;
    box-shadow: 
      0 8px 32px -8px rgba(0, 0, 0, 0.3),
      0 16px 48px -16px rgba(59, 130, 246, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.15);
    overflow: hidden;
  }
  .card-3d-pop::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 2px;
    background: linear-gradient(
      135deg, 
      rgba(233, 206, 176, 0.6) 0%, 
      rgba(233, 206, 176, 0.2) 25%,
      rgba(255, 255, 255, 0.4) 50%,
      rgba(233, 206, 176, 0.2) 75%,
      rgba(233, 206, 176, 0.6) 100%
    );
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    animation: border-glow-rotate 6s linear infinite;
    pointer-events: none;
  }
  @keyframes border-glow-rotate {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  .card-3d-pop::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 50%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.1),
      transparent
    );
    animation: card-shine 5s ease-in-out infinite;
    pointer-events: none;
  }
  @keyframes card-shine {
    0%, 100% { left: -100%; }
    50% { left: 150%; }
  }
  .card-3d-pop:hover {
    transform: translateY(-4px) scale(1.01);
    box-shadow: 
      0 12px 40px -8px rgba(0, 0, 0, 0.35),
      0 24px 64px -16px rgba(59, 130, 246, 0.3),
      0 0 60px rgba(233, 206, 176, 0.2);
  }

  /* ===== LIQUID GLASS EFFECT ===== */
  .liquid-glass {
    position: relative;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.25) 0%,
      rgba(255, 255, 255, 0.1) 25%,
      rgba(255, 255, 255, 0.05) 50%,
      rgba(255, 255, 255, 0.1) 75%,
      rgba(255, 255, 255, 0.2) 100%
    );
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow:
      0 8px 32px rgba(0, 0, 0, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.4),
      inset 0 -1px 0 rgba(0, 0, 0, 0.05),
      0 0 0 1px rgba(255, 255, 255, 0.1);
    overflow: hidden;
  }
  .liquid-glass::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 50%;
    background: linear-gradient(
      180deg,
      rgba(255, 255, 255, 0.3) 0%,
      rgba(255, 255, 255, 0.1) 50%,
      transparent 100%
    );
    border-radius: inherit;
    pointer-events: none;
  }
  .liquid-glass::after {
    content: '';
    position: absolute;
    top: -100%;
    left: -100%;
    width: 300%;
    height: 300%;
    background: radial-gradient(
      ellipse at 30% 20%,
      rgba(255, 255, 255, 0.15) 0%,
      transparent 50%
    );
    animation: liquid-flow 8s ease-in-out infinite;
    pointer-events: none;
  }
  @keyframes liquid-flow {
    0%, 100% { transform: translate(0%, 0%) rotate(0deg); }
    25% { transform: translate(10%, 5%) rotate(2deg); }
    50% { transform: translate(5%, 10%) rotate(-1deg); }
    75% { transform: translate(-5%, 5%) rotate(1deg); }
  }

  /* Liquid Glass Button - More vibrant for CTAs */
  .liquid-glass-btn {
    position: relative;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.3) 0%,
      rgba(255, 255, 255, 0.15) 50%,
      rgba(255, 255, 255, 0.25) 100%
    );
    -webkit-backdrop-filter: blur(16px) saturate(200%);
    backdrop-filter: blur(16px) saturate(200%);
    border: 1px solid rgba(255, 255, 255, 0.4);
    box-shadow:
      0 4px 24px rgba(0, 0, 0, 0.15),
      0 8px 32px rgba(99, 102, 241, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.5),
      inset 0 -1px 0 rgba(0, 0, 0, 0.1);
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .liquid-glass-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 50%;
    background: linear-gradient(
      180deg,
      rgba(255, 255, 255, 0.4) 0%,
      rgba(255, 255, 255, 0.15) 60%,
      transparent 100%
    );
    border-radius: inherit;
    pointer-events: none;
  }
  .liquid-glass-btn::after {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(
      circle at 30% 30%,
      rgba(255, 255, 255, 0.25) 0%,
      transparent 40%
    );
    animation: liquid-shimmer 6s ease-in-out infinite;
    pointer-events: none;
  }
  @keyframes liquid-shimmer {
    0%, 100% { transform: translate(-10%, -10%) scale(1); opacity: 0.8; }
    50% { transform: translate(10%, 10%) scale(1.1); opacity: 1; }
  }
  .liquid-glass-btn:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow:
      0 8px 40px rgba(0, 0, 0, 0.2),
      0 16px 48px rgba(99, 102, 241, 0.3),
      0 0 60px rgba(139, 92, 246, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.6);
    border-color: rgba(255, 255, 255, 0.5);
  }

  /* Liquid Glass Card - For pricing/feature cards */
  .liquid-glass-card {
    position: relative;
    background: linear-gradient(
      145deg,
      rgba(255, 255, 255, 0.2) 0%,
      rgba(255, 255, 255, 0.08) 30%,
      rgba(255, 255, 255, 0.05) 70%,
      rgba(255, 255, 255, 0.15) 100%
    );
    -webkit-backdrop-filter: blur(24px) saturate(180%);
    backdrop-filter: blur(24px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.25);
    box-shadow:
      0 8px 32px rgba(0, 0, 0, 0.12),
      0 16px 48px rgba(59, 130, 246, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.35),
      inset 0 -1px 0 rgba(0, 0, 0, 0.05);
    overflow: hidden;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .liquid-glass-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 40%;
    background: linear-gradient(
      180deg,
      rgba(255, 255, 255, 0.25) 0%,
      rgba(255, 255, 255, 0.08) 50%,
      transparent 100%
    );
    border-radius: inherit;
    pointer-events: none;
  }
  .liquid-glass-card::after {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: 
      radial-gradient(ellipse at 20% 20%, rgba(255, 255, 255, 0.12) 0%, transparent 40%),
      radial-gradient(ellipse at 80% 80%, rgba(255, 255, 255, 0.08) 0%, transparent 40%);
    animation: liquid-card-flow 10s ease-in-out infinite;
    pointer-events: none;
  }
  @keyframes liquid-card-flow {
    0%, 100% { transform: translate(0%, 0%) rotate(0deg); }
    33% { transform: translate(5%, 3%) rotate(1deg); }
    66% { transform: translate(-3%, 5%) rotate(-1deg); }
  }
  .liquid-glass-card:hover {
    transform: translateY(-4px);
    box-shadow:
      0 12px 48px rgba(0, 0, 0, 0.18),
      0 24px 64px rgba(59, 130, 246, 0.15),
      0 0 80px rgba(139, 92, 246, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.45);
    border-color: rgba(255, 255, 255, 0.35);
  }

  /* Feature card liquid glass variant */
  .liquid-glass-feature {
    position: relative;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.15) 0%,
      rgba(255, 255, 255, 0.05) 50%,
      rgba(255, 255, 255, 0.1) 100%
    );
    -webkit-backdrop-filter: blur(16px) saturate(160%);
    backdrop-filter: blur(16px) saturate(160%);
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow:
      0 4px 24px rgba(0, 0, 0, 0.08),
      inset 0 1px 0 rgba(255, 255, 255, 0.3),
      inset 0 -1px 0 rgba(0, 0, 0, 0.03);
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .liquid-glass-feature::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 45%;
    background: linear-gradient(
      180deg,
      rgba(255, 255, 255, 0.2) 0%,
      rgba(255, 255, 255, 0.05) 60%,
      transparent 100%
    );
    border-radius: inherit;
    pointer-events: none;
  }
  .liquid-glass-feature:hover {
    transform: translateY(-3px);
    box-shadow:
      0 8px 32px rgba(0, 0, 0, 0.12),
      0 0 40px rgba(99, 102, 241, 0.08),
      inset 0 1px 0 rgba(255, 255, 255, 0.4);
    border-color: rgba(255, 255, 255, 0.3);
  }
}

/* FORCE SANDPACK HEIGHT - Global overrides */
.sp-wrapper {
  height: 100% !important;
  display: flex !important;
  flex-direction: column;
}

.sp-layout {
  height: 100% !important;
  display: flex !important;
  flex: 1 !important;
  background-color: transparent !important;
}

.sp-stack {
  height: 100% !important;
}

.sp-preview-container, 
.sp-preview-iframe {
  height: 100% !important;
  min-height: 100% !important;
}

.cm-editor {
  height: 100% !important;
}

.sp-file-explorer {
  height: 100% !important;
}

.sp-code-editor {
  height: 100% !important;
}

/* Custom Scrollbar for Sandpack Studio */
.sp-wrapper ::-webkit-scrollbar,
.sandpack-preview-container ::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

.sp-wrapper ::-webkit-scrollbar-track,
.sandpack-preview-container ::-webkit-scrollbar-track {
  background: #0c0f14; 
}

.sp-wrapper ::-webkit-scrollbar-thumb,
.sandpack-preview-container ::-webkit-scrollbar-thumb {
  background: #334155; 
  border-radius: 3px;
}

.sp-wrapper ::-webkit-scrollbar-thumb:hover,
.sandpack-preview-container ::-webkit-scrollbar-thumb:hover {
  background: #475569; 
}

/* 3D Card Flip Utilities */
.perspective-1000 {
  -webkit-perspective: 1000px;
  perspective: 1000px;
}

.transform-style-3d {
  -webkit-transform-style: preserve-3d;
  transform-style: preserve-3d;
}

.backface-hidden {
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
}

.rotate-y-180 {
  -webkit-transform: rotateY(180deg);
  transform: rotateY(180deg);
}

/* Card flip container */
.card-flip-container {
  position: relative;
  width: 100%;
  height: 100%;
  -webkit-transform-style: preserve-3d;
  transform-style: preserve-3d;
  transition: transform 0.7s ease;
}

.card-flip-container.flipped {
  -webkit-transform: rotateY(180deg);
  transform: rotateY(180deg);
}

.card-flip-front,
.card-flip-back {
  position: absolute;
  width: 100%;
  height: 100%;
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  border-radius: 20px;
}

.card-flip-front {
  z-index: 2;
}

.card-flip-back {
  -webkit-transform: rotateY(180deg);
  transform: rotateY(180deg);
  z-index: 1;
}

/* ============================================
   SANDPACK RESIZE HANDLE - FORCE HIDE
   ============================================ */
.sp-resize-handler,
.sp-layout .sp-resize-handler,
[class*="sp-resize"],
[class*="ResizeHandler"],
[data-resize-handle],
.sp-layout > div:not(.sp-stack):not(.sp-preview-container):not(.sp-code-editor) {
  display: none !important;
  width: 0 !important;
  height: 0 !important;
  opacity: 0 !important;
  visibility: hidden !important;
  pointer-events: none !important;
}

/* Target the specific resize handle structure */
.sp-layout > div[style*="position: absolute"],
.sp-layout > div[style*="cursor"] {
  display: none !important;
  visibility: hidden !important;
}
